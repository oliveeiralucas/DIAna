// ========================================
// CONFIGURAÇÃO DO PRISMA
// ========================================

generator client {
  provider = "prisma-client-js"
  output   = "./generated"
}

datasource db {
  provider = "postgresql"
}

// ========================================
// ENUMS
// ========================================

enum TipoReuniao {
  VIRTUAL
  PRESENCIAL
}

enum StatusAta {
  PENDENTE
  APROVADA
  REJEITADA
}

// ========================================
// MODELS
// ========================================

model Usuario {
  id        String   @id @default(uuid()) @db.Uuid
  email     String   @unique @db.VarChar(255)
  nome      String   @db.VarChar(255)
  senha     String   @db.VarChar(255)
  ativo     Boolean  @default(true)
  createdAt DateTime @default(now()) @map("created_at")

  // Relações
  atasAprovadas Ata[] @relation("AprovadorAta")

  @@map("usuario")
}

model Ata {
  id String @id @default(uuid()) @db.Uuid

  // Campos migrados de Reuniao
  titulo         String      @db.VarChar(500)
  tipo           TipoReuniao
  dataReuniao    DateTime    @map("data_reuniao")
  duracaoMinutos Int?        @map("duracao_minutos")

  // Áudio (migrado de Reuniao)
  arquivoAudioBase64  String? @map("arquivo_audio_base64") @db.Text
  arquivoAudioNome    String? @map("arquivo_audio_nome") @db.VarChar(255)
  arquivoAudioTipo    String? @map("arquivo_audio_tipo") @db.VarChar(50)
  arquivoAudioTamanho Int?    @map("arquivo_audio_tamanho")

  // Participantes (migrado de tabela Participante)
  participantes Json? @db.JsonB // Array<{ nome: string, email?: string }>

  // Estrutura JSON completa da ata (existente)
  identificacao     Json?   @db.JsonB // { titulo, data, participantes }
  objetivo          String? @db.Text
  topicosDiscutidos Json?   @map("topicos_discutidos") @db.JsonB // Array de tópicos
  decisoes          Json?   @db.JsonB // Array de decisões
  acoes             Json?   @db.JsonB // Array de ações
  pendencias        Json?   @db.JsonB // Array de pendências
  proximosPassos    Json?   @map("proximos_passos") @db.JsonB // { atividades, proxima_reuniao }

  // Aprovação (existente)
  status        StatusAta @default(PENDENTE)
  aprovadoPorId String?   @map("aprovado_por_id") @db.Uuid
  dataAprovacao DateTime? @map("data_aprovacao")
  comentarios   String?   @db.Text

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  // Relações
  aprovadoPor Usuario? @relation("AprovadorAta", fields: [aprovadoPorId], references: [id])

  @@index([status])
  @@index([dataReuniao(sort: Desc)])
  @@index([tipo])
  @@map("ata")
}
